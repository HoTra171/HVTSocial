  console.log
    ðŸ§ª Test environment initialized

      at tests/setup.js:24:9

(node:84384) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.error
    Login error: Error: Illegal arguments: string, undefined
        at _async (H:\HocTap\DoAn\HVTSocial\Backend\node_modules\bcryptjs\index.js:252:11)
        at H:\HocTap\DoAn\HVTSocial\Backend\node_modules\bcryptjs\index.js:280:7
        at new Promise (<anonymous>)
        at Object.compare (H:\HocTap\DoAn\HVTSocial\Backend\node_modules\bcryptjs\index.js:279:12)
        at login (H:\HocTap\DoAn\HVTSocial\Backend\controllers\authController.js:175:34)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

    [0m [90m 197 |[39m     )[33m;[39m
     [90m 198 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 199 |[39m     console[33m.[39merror([32m'Login error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 200 |[39m     [36mreturn[39m errorResponse(res[33m,[39m [32m'Lá»—i server, vui lÃ²ng thá»­ láº¡i sau'[39m)[33m;[39m
     [90m 201 |[39m   }
     [90m 202 |[39m }[33m;[39m[0m

      at login (controllers/authController.js:199:13)

  console.error
    Login error: Error: Illegal arguments: string, undefined
        at _async (H:\HocTap\DoAn\HVTSocial\Backend\node_modules\bcryptjs\index.js:252:11)
        at H:\HocTap\DoAn\HVTSocial\Backend\node_modules\bcryptjs\index.js:280:7
        at new Promise (<anonymous>)
        at Object.compare (H:\HocTap\DoAn\HVTSocial\Backend\node_modules\bcryptjs\index.js:279:12)
        at login (H:\HocTap\DoAn\HVTSocial\Backend\controllers\authController.js:175:34)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

    [0m [90m 197 |[39m     )[33m;[39m
     [90m 198 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 199 |[39m     console[33m.[39merror([32m'Login error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 200 |[39m     [36mreturn[39m errorResponse(res[33m,[39m [32m'Lá»—i server, vui lÃ²ng thá»­ láº¡i sau'[39m)[33m;[39m
     [90m 201 |[39m   }
     [90m 202 |[39m }[33m;[39m[0m

      at login (controllers/authController.js:199:13)

  console.error
    Refresh token error: TypeError: Cannot read properties of undefined (reading 'length')
        at refreshToken (H:\HocTap\DoAn\HVTSocial\Backend\controllers\authController.js:423:26)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

    [0m [90m 462 |[39m     [36mreturn[39m successResponse(res[33m,[39m tokens[33m,[39m [32m'LÃ m má»›i token thÃ nh cÃ´ng'[39m)[33m;[39m
     [90m 463 |[39m   } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 464 |[39m     console[33m.[39merror([32m'Refresh token error:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 465 |[39m     [36mreturn[39m errorResponse(res[33m,[39m [32m'Lá»—i Server'[39m)[33m;[39m
     [90m 466 |[39m   }
     [90m 467 |[39m }[33m;[39m[0m

      at refreshToken (controllers/authController.js:464:13)

FAIL tests/auth.test.js
  Auth Controller Unit Tests
    POST /register
      Ã— Success: Should create user and return 201 (189 ms)
      Ã— Fail: Duplicate Email (409) (10 ms)
    POST /login
      Ã— Success: Should return tokens (147 ms)
      Ã— Fail: Wrong Password (401) (119 ms)
    POST /refresh
      Ã— Success: Should rotate tokens (22 ms)
    POST /logout
      âˆš Success: Should revoke token (12 ms)

  â— Auth Controller Unit Tests â€º POST /register â€º Success: Should create user and return 201

    expect(jest.fn()).toHaveBeenCalledTimes(expected)

    Expected number of calls: 3
    Received number of calls: 2

    [0m [90m 57 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m 58 |[39m       expect(res[33m.[39mbody[33m.[39msuccess)[33m.[39mtoBe([36mtrue[39m)[33m;[39m
    [31m[1m>[22m[39m[90m 59 |[39m       expect(mockRequest[33m.[39mquery)[33m.[39mtoHaveBeenCalledTimes([35m3[39m)[33m;[39m
     [90m    |[39m                                 [31m[1m^[22m[39m
     [90m 60 |[39m     })[33m;[39m
     [90m 61 |[39m
     [90m 62 |[39m     test([32m'Fail: Duplicate Email (409)'[39m[33m,[39m [36masync[39m () [33m=>[39m {[0m

      at Object.<anonymous> (tests/auth.test.js:59:33)

  â— Auth Controller Unit Tests â€º POST /register â€º Fail: Duplicate Email (409)

    expect(received).toBe(expected) // Object.is equality

    Expected: 409
    Received: 400

    [0m [90m 73 |[39m       })[33m;[39m
     [90m 74 |[39m
    [31m[1m>[22m[39m[90m 75 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m409[39m)[33m;[39m
     [90m    |[39m                          [31m[1m^[22m[39m
     [90m 76 |[39m       expect(res[33m.[39mbody[33m.[39mmessage)[33m.[39mtoMatch([35m/exists/i[39m)[33m;[39m
     [90m 77 |[39m     })[33m;[39m
     [90m 78 |[39m   })[33m;[39m[0m

      at Object.<anonymous> (tests/auth.test.js:75:26)

  â— Auth Controller Unit Tests â€º POST /login â€º Success: Should return tokens

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 102 |[39m       })[33m;[39m
     [90m 103 |[39m
    [31m[1m>[22m[39m[90m 104 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 105 |[39m       expect(res[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'accessToken'[39m)[33m;[39m
     [90m 106 |[39m       expect(res[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'refreshToken'[39m)[33m;[39m
     [90m 107 |[39m     })[33m;[39m[0m

      at Object.<anonymous> (tests/auth.test.js:104:26)

  â— Auth Controller Unit Tests â€º POST /login â€º Fail: Wrong Password (401)

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 500

    [0m [90m 125 |[39m       })[33m;[39m
     [90m 126 |[39m
    [31m[1m>[22m[39m[90m 127 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m401[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 128 |[39m     })[33m;[39m
     [90m 129 |[39m   })[33m;[39m
     [90m 130 |[39m[0m

      at Object.<anonymous> (tests/auth.test.js:127:26)

  â— Auth Controller Unit Tests â€º POST /refresh â€º Success: Should rotate tokens

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

    [0m [90m 151 |[39m       })[33m;[39m
     [90m 152 |[39m
    [31m[1m>[22m[39m[90m 153 |[39m       expect(res[33m.[39mstatus)[33m.[39mtoBe([35m200[39m)[33m;[39m
     [90m     |[39m                          [31m[1m^[22m[39m
     [90m 154 |[39m       expect(res[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'accessToken'[39m)[33m;[39m
     [90m 155 |[39m       expect(res[33m.[39mbody[33m.[39mdata)[33m.[39mtoHaveProperty([32m'refreshToken'[39m)[33m;[39m
     [90m 156 |[39m       expect(res[33m.[39mbody[33m.[39mdata[33m.[39mrefreshToken)[33m.[39mnot[33m.[39mtoBe([32m'valid_refresh_token'[39m)[33m;[39m[0m

      at Object.<anonymous> (tests/auth.test.js:153:26)

Test Suites: 1 failed, 1 total
Tests:       5 failed, 1 passed, 6 total
Snapshots:   0 total
Time:        1.864 s, estimated 2 s
Ran all test suites matching tests/auth.test.js.
